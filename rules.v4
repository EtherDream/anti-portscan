# Created by IriKa Qiu on Sat Jan 14 01:45:15 HKT 2023
*mangle
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
:trap-scan - [0:0]
:DROP_LOG - [0:0]
-A trap-scan -m set --match-set scanner-ipv4-set src -j DROP_LOG
-A trap-scan -j SET --add-set scanner-ipv4-set src
-A trap-scan -j DROP_LOG
-A DROP_LOG -j LOG --log-level warning --log-prefix "DROP: "
-A DROP_LOG -j DROP
-I PREROUTING -i eth0 -p tcp ! --syn -m conntrack ! --ctstate RELATED,ESTABLISHED -j trap-scan
COMMIT
# Completed on Sat Jan 14 01:45:15 HKT 2023
# Created by IriKa Qiu on Sat Jan 14 01:45:15 HKT 2023
*raw
:PREROUTING ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:scaner-detect - [0:0]
:scaner-detect-udp - [0:0]
:trap-scan - [0:0]
:record-ingress - [0:0]
:no-match-pub-udp - [0:0]
:DROP_LOG - [0:0]
-A scaner-detect -m addrtype ! --dst-type LOCAL -j DROP
-A scaner-detect -m set --match-set scanner-ipv4-set src ! --update-counters --packets-gt 3 -j DROP_LOG
-A scaner-detect -p tcp --syn -m set ! --match-set ipv4-pub-tcp-port-set dst -j trap-scan
-A scaner-detect -p udp -j scaner-detect-udp
-A scaner-detect-udp -m set ! --match-set ipv4-pub-udp-port-set dst -j no-match-pub-udp
-A scaner-detect-udp -j record-ingress
-A trap-scan -m set --match-set scanner-ipv4-set src -j DROP_LOG
-A trap-scan -j SET --add-set scanner-ipv4-set src
-A trap-scan -j DROP_LOG
#-A record-ingress -j LOG --log-level warning --log-prefix "UDP IN (RECORD): "
-A record-ingress -j SET --add-set ipv4-egress-port-set dst,dst --exist
#-A no-match-pub-udp -m set ! --match-set ipv4-egress-port-set dst,dst -j LOG --log-level warning --log-prefix "UDP IN DROP: "
-A no-match-pub-udp -m set ! --match-set ipv4-egress-port-set dst,dst -j trap-scan
-A DROP_LOG -j LOG --log-level warning --log-prefix "DROP: "
-A DROP_LOG -j DROP
-I PREROUTING -i eth0 -j scaner-detect
COMMIT
# Completed on Sat Jan 14 01:45:15 HKT 2023
# Created by IriKa Qiu on Sat Jan 14 01:45:15 HKT 2023
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
COMMIT
# Completed on Sat Jan 14 01:45:15 HKT 2023
# Created by IriKa Qiu on Sat Jan 14 01:45:15 HKT 2023
*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
:record-egress - [0:0]
#-A record-egress -j LOG --log-level warning --log-prefix "UDP OUT (RECORD): "
-A record-egress -j SET --add-set ipv4-egress-port-set src,src --exist
-I POSTROUTING -o eth0 -p udp -j record-egress
COMMIT
# Completed on Sat Jan 14 01:45:15 HKT 2023
